<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>akrantiain変換部の仕様</title>
<link rel="stylesheet" type="text/css" href="main.css">
<style>
table.stat { border-spacing: 7px 1px; }
table.stat td { border-color : orange;
     border-width : 2px;
     border-style : solid;
     padding : 4px;
     text-align:center;
}
</style>
</head>
<body>
<div><a href="https://github.com/sozysozbot/akrantiain2">View on Github</a></div>
<h2>akrantiainマニュアル</h2>
<h3>4. akrantiain変換部の仕様</h3>
<h4 id="structure">4-0. 概略</h4>
<pre>
変換部は、「環境情報(環境指定識別子一覧と句読点情報からなる)」「変換規則のリスト」「入力文字列」を受けとり、「実行時エラー」または「出力文字列」を返す。
なお、環境情報は大局的な定数であり、変換部の処理を行う任意のタイミングで参照されうる。
2017/03/22 20:49現在、akrantiain変換部は以下のような流れになっている。
</pre>
<!-- これはcook -->
<ol style="font-family:monospace">
<li>
        環境指定識別子<code><span class="identifier">CASE_SENSITIVE</span></code>が指定されていなければ、変換規則の入力部と入力文字列を小文字に変換する。
</li>
<li>
        入力文字列の末尾にスペースを付加し、Statに変換する
</li>
<li>「変換規則のリスト」を左から走査していき、Statに順に変換規則を<a href="#apply">適用</a>していく</li>
<li>Statのうち未処理のものがある場合、変換元がスペースまたは句読点なら変換先にスペースを指定する。そうでなければ実行時エラー#210を吐く。</li>
<li>変換先を全てつなげ、出力文字列とする。</li>
</ol>
<pre>
Statと変換規則の仕様は後述。
</pre>
<h4 id="stat">4-1. Stat</h4>
<pre>Statは、「『文字列と文字列の対』の配列」である。初期状態は、（1文字と未定義の対）の配列であり、例えば入力文字列が"spaghetti"であれば、次のような初期状態となる。</pre>
<table class="stat">
<tr><td>"s"</td><td>"p"</td><td>"a"</td><td>"g"</td><td>"h"</td><td>"e"</td><td>"t"</td><td>"t"</td><td>"i"</td></tr>
<tr><td>null</td><td>null</td><td>null</td><td>null</td><td>null</td><td>null</td><td>null</td><td>null</td><td>null</td></tr>
</table>
<h4 id="convert">4-2. 変換規則</h4>
<pre>変換規則は、以下の3要素からなる。<!-- data Rule --><code><u>PHONEME</u></code>の定義については<a href="manuals_ja.htm">マニュアル</a>を参照のこと。
<code><u>Negation</u></code><!-- data Condition -->は「文字列の集合または語境界」を要素として持ち、それらが登場しない時に限り変換を行うことを表す。
</pre>
<ol style="font-family:monospace; line-height:170%">
<li>左条件（省略可能）
        <ul><li><code><u>Negation</u></code></li></ul>
</li>
<li>変換元と変換先の対応
        <ul><li>「『語境界』または『文字列の集合と<code><u>PHONEME</u></code>の対』」の配列</li></ul>
</li>
<li>右条件（省略可能）
        <ul><li><code><u>Negation</u></code></li></ul>
</li>
</ol>

<h4 id="apply">4-3. 変換規則の適用</h4>
<!-- apply -->
<pre>変換規則適用は、「Stat」と「変換規則」を受け取り、「Stat」を返す。
2017/03/22 20:49現在、変換規則の適用は以下のような流れで行われている。
</pre>
<ol style="font-family:monospace; line-height:170%">
<li>受け取ったStatと変換規則をmatchに渡し、「『Statの対』のリスト」hogeを得る。</li>
<li>hogeが空なら最初のStatを変更せずに返し、さもなくばリストhogeの最終要素に(a,b)と名付け続行。</li>
<li>「aと変換規則をmatchに渡し返ってきたStat」の後ろにbを結合し、返す。</li>
</ol>

<h4 id="match">4-4. match関数の仕様</h4>
<!-- match -->
<pre>match関数は、「Stat」と「変換規則」を受け取り、「『Statの対』のリスト」を返す。</pre>
<ol style="font-family:monospace; line-height:170%">
<li> 「Statを二分したもの」の一覧を用意する。</li>
<li>変換規則を右から、つまり「右条件→『変換元と変換先の対応』→左条件」の順に辿っていき、一覧の中のうちパターンにマッチするもののみを残しながら、変換先を書き込んでいく</li>
</ol>
<pre>
というのが大まかな流れである。
以下、辿っていくときに行われることを具体的に説明していく。
</pre>
<!-- FIXME: 語境界の否定は未実装 -->
<h5>4-4-0.候補の用意</h5>
<pre>これについては「百聞は一見に如かず」なので、図を用いる。</pre>
<pre>入力:</pre>
<table class="stat">
<tr><td>"ch"</td><td>"a"</td><td>"t"</td><td>"eau"</td></tr>
<tr><td>/ʃ/</td><td>null</td><td>null</td><td>null</td></tr>
</table>
<pre>出力:</pre>
<table>
<tr><td>(</td><td>
        <table class="stat">
        <tr></tr>
        <tr></tr>
        </table></td><td>,</td><td><table class="stat">
        <tr><td>"ch"</td><td>"a"</td><td>"t"</td><td>"eau"</td></tr>
        <tr><td>/ʃ/</td><td>null</td><td>null</td><td>null</td></tr>
        </table></td>
        <td>)</td>
</td></tr>
<tr><td>(</td><td>
        <table class="stat">
        <tr><td>"ch"</td></tr>
        <tr><td>/ʃ/</td></tr>
        </table></td><td>,</td><td><table class="stat">
        <tr><td>"a"</td><td>"t"</td><td>"eau"</td></tr>
        <tr><td>null</td><td>null</td><td>null</td></tr>
        </table></td>
        <td>)</td>
</td></tr>
<tr><td>(</td><td>
        <table class="stat">
        <tr><td>"ch"</td><td>"a"</td></tr>
        <tr><td>/ʃ/</td><td>null</td></tr>
        </table></td><td>,</td><td><table class="stat">
        <tr><td>"t"</td><td>"eau"</td></tr>
        <tr><td>null</td><td>null</td></tr>
        </table></td>
        <td>)</td>
</td></tr>
<tr><td>(</td><td>
        <table class="stat">
        <tr><td>"ch"</td><td>"a"</td><td>"t"</td></tr>
        <tr><td>/ʃ/</td><td>null</td><td>null</td></tr>
        </table></td><td>,</td><td><table class="stat">
        <tr><td>"eau"</td></tr>
        <tr><td>null</td></tr>
        </table></td>
        <td>)</td>
</td></tr>
<tr><td>(</td><td>
        <table class="stat">
        <tr><td>"ch"</td><td>"a"</td><td>"t"</td><td>"eau"</td></tr>
        <tr><td>/ʃ/</td><td>null</td><td>null</td><td>null</td></tr>
        </table></td><td>,</td><td><table class="stat">
        <tr></tr>
        <tr></tr>
        </table></td>
        <td>)</td>
</td></tr>
</table>
<h5>4-4-1.</h5>
<pre></pre>
<h5>4-4-2.</h5>
<pre></pre>
<h5>4-4-3.</h5>
<pre></pre>
</body>
</html>
